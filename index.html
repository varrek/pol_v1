<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voting System</title>
    <!-- QR Code Generation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- QR Code Scanner Library -->
    <script src="https://cdn.jsdelivr.net/npm/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .user-id {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
            font-size: 0.9em;
        }

        .nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav button {
            flex: 1;
            min-width: 150px;
            padding: 12px 20px;
            border: none;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .nav button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .nav button.active {
            background: #667eea;
            color: white;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        input.error {
            border-color: #f44336;
        }

        .error-message {
            color: #f44336;
            font-size: 14px;
            margin-top: 5px;
        }

        .options-container {
            margin-bottom: 20px;
        }

        .option-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .option-input input {
            flex: 1;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 16px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        .poll-card {
            background: #f9f9f9;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .poll-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .poll-card h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .poll-meta {
            font-size: 14px;
            color: #777;
        }

        .poll-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .poll-status.open {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .poll-status.closed {
            background: #ffcdd2;
            color: #c62828;
        }

        .voting-form {
            margin: 20px 0;
        }

        .radio-group {
            margin-bottom: 15px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .radio-option:hover {
            border-color: #667eea;
            background: #f5f5f5;
        }

        .radio-option input[type="radio"] {
            margin-right: 12px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .result-bar {
            margin-bottom: 20px;
        }

        .result-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .progress-bar {
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            padding-left: 12px;
            color: white;
            font-weight: 600;
        }

        .total-votes {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            font-weight: 600;
            color: #667eea;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.success {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .message.error {
            background: #ffcdd2;
            color: #c62828;
        }

        .message.info {
            background: #bbdefb;
            color: #1565c0;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #777;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 2em;
            }

            .nav {
                flex-direction: column;
            }

            .nav button {
                width: 100%;
            }

            .card {
                padding: 20px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-buttons button {
                width: 100%;
            }
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #777;
        }

        .back-button {
            margin-bottom: 20px;
        }

        /* QR Code Styles */
        .qr-section {
            margin-top: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            text-align: center;
        }

        .qr-code-container {
            display: inline-block;
            padding: 20px;
            background: white;
            border-radius: 8px;
            margin: 20px 0;
        }

        #qr-scanner {
            width: 100%;
            max-width: 500px;
            margin: 20px auto;
        }

        #qr-reader {
            border-radius: 8px;
            overflow: hidden;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .share-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .scanner-view {
            display: none;
        }

        .scanner-view.active {
            display: block;
        }

        /* Language Switcher Styles */
        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 5px;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px;
            border-radius: 20px;
        }

        .language-switcher button {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: white;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }

        .language-switcher button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .language-switcher button.active {
            background: white;
            color: #667eea;
        }

        @media (max-width: 600px) {
            .language-switcher {
                position: static;
                justify-content: center;
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Language Switcher -->
        <div class="language-switcher">
            <button onclick="setLanguage('en')" id="lang-en">EN</button>
            <button onclick="setLanguage('uk')" id="lang-uk">UA</button>
        </div>

        <div class="header">
            <h1>üó≥Ô∏è <span id="header-title">Voting System</span></h1>
            <div class="user-id"><span id="user-id-label">User ID</span>: <span id="current-user-id"></span></div>
        </div>

        <nav class="nav">
            <button class="active" onclick="showView('polls')" id="nav-polls">All Polls</button>
            <button onclick="showView('create')" id="nav-create">Create Poll</button>
            <button onclick="showView('scanner')" id="nav-scanner">üì∑ Scan QR</button>
        </nav>

        <!-- Polls List View -->
        <div id="polls-view" class="view active">
            <div class="card">
                <h2>All Polls</h2>
                <div id="polls-list"></div>
            </div>
        </div>

        <!-- Create Poll View -->
        <div id="create-view" class="view">
            <div class="card">
                <h2>Create New Poll</h2>
                <div id="create-message"></div>
                <form id="create-poll-form" onsubmit="handleCreatePoll(event)">
                    <div class="form-group">
                        <label for="poll-question">Question *</label>
                        <input type="text" id="poll-question" placeholder="Enter your poll question">
                        <div id="question-error" class="error-message"></div>
                    </div>

                    <div class="form-group">
                        <label>Options * (minimum 2)</label>
                        <div id="options-container" class="options-container"></div>
                        <button type="button" class="btn btn-secondary btn-small" onclick="addOption()">+ Add Option</button>
                    </div>

                    <button type="submit" class="btn btn-primary">Create Poll</button>
                </form>
            </div>
        </div>

        <!-- Poll Detail View -->
        <div id="detail-view" class="view">
            <div class="card">
                <div class="back-button">
                    <button class="btn btn-secondary btn-small" onclick="showView('polls')">‚Üê Back to Polls</button>
                </div>
                <div id="poll-detail"></div>
            </div>
        </div>

        <!-- QR Scanner View -->
        <div id="scanner-view" class="view">
            <div class="card">
                <h2>Scan QR Code</h2>
                <p style="color: #666; margin-bottom: 20px;">Point your camera at a poll QR code to join</p>
                <div id="qr-reader"></div>
                <div id="scan-result"></div>
                <button class="btn btn-secondary" onclick="stopScanner(); showView('polls');" style="margin-top: 20px;">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== INTERNATIONALIZATION (i18n) ====================
        
        // Translation data
        const translations = {
            en: {
                // Header
                headerTitle: 'Voting System',
                userIdLabel: 'User ID',
                
                // Navigation
                navPolls: 'All Polls',
                navCreate: 'Create Poll',
                navScanner: 'üì∑ Scan QR',
                
                // Polls List
                pollsTitle: 'All Polls',
                noPollsTitle: 'No polls yet',
                noPollsText: 'Create your first poll to get started!',
                pollsOptions: 'options',
                pollsVotes: 'votes',
                pollStatusOpen: 'OPEN',
                pollStatusClosed: 'CLOSED',
                
                // Create Poll
                createTitle: 'Create New Poll',
                createQuestionLabel: 'Question',
                createQuestionPlaceholder: 'Enter your poll question',
                createOptionsLabel: 'Options',
                createOptionsMinimum: '(minimum 2)',
                createOptionPlaceholder: 'Option',
                createAddOption: '+ Add Option',
                createSubmit: 'Create Poll',
                createSuccess: 'Poll created successfully!',
                createErrorQuestion: 'Question is required',
                createErrorOptions: 'Please provide at least 2 options',
                
                // Poll Detail
                backToPolls: '‚Üê Back to Polls',
                pollClosed: 'This poll is closed',
                alreadyVoted: 'You have already voted on this poll',
                castVoteButton: 'Cast Vote',
                totalVotes: 'Total Votes',
                
                // QR Code Section
                shareTitle: 'Share this Poll',
                shareDescription: 'Scan QR code to join this poll',
                shareCopyLink: 'üìã Copy Link',
                shareDownloadQR: '‚¨áÔ∏è Download QR',
                shareLinkCopied: 'Poll link copied to clipboard!',
                shareLinkFailed: 'Failed to copy link. URL',
                
                // Scanner
                scanTitle: 'Scan QR Code',
                scanDescription: 'Point your camera at a poll QR code to join',
                scanCancel: 'Cancel',
                scanInvalid: 'Invalid QR code. Please scan a poll QR code.',
                scanErrorCamera: 'Error starting camera',
                scanErrorNoCameras: 'No cameras found. Please check permissions.',
                
                // Poll Management
                closePollButton: 'Close Poll',
                deletePollButton: 'Delete Poll',
                closePollConfirm: 'Are you sure you want to close this poll? No more votes can be cast after closing.',
                deletePollConfirm: 'Are you sure you want to delete this poll? This action cannot be undone.',
                
                // Poll Results
                votesCount: 'votes',
                
                // Errors and Messages
                pollNotFound: 'Poll not found',
                errorOccurred: 'An error occurred',
                removeOption: 'Remove',
                
                // Empty state
                loading: 'Loading...'
            },
            uk: {
                // Header / –ó–∞–≥–æ–ª–æ–≤–æ–∫
                headerTitle: '–°–∏—Å—Ç–µ–º–∞ –ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è',
                userIdLabel: 'ID –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞',
                
                // Navigation / –ù–∞–≤—ñ–≥–∞—Ü—ñ—è
                navPolls: '–í—Å—ñ –û–ø–∏—Ç—É–≤–∞–Ω–Ω—è',
                navCreate: '–°—Ç–≤–æ—Ä–∏—Ç–∏ –û–ø–∏—Ç—É–≤–∞–Ω–Ω—è',
                navScanner: 'üì∑ –°–∫–∞–Ω—É–≤–∞—Ç–∏ QR',
                
                // Polls List / –°–ø–∏—Å–æ–∫ –æ–ø–∏—Ç—É–≤–∞–Ω—å
                pollsTitle: '–í—Å—ñ –û–ø–∏—Ç—É–≤–∞–Ω–Ω—è',
                noPollsTitle: '–û–ø–∏—Ç—É–≤–∞–Ω—å —â–µ –Ω–µ–º–∞—î',
                noPollsText: '–°—Ç–≤–æ—Ä—ñ—Ç—å –ø–µ—Ä—à–µ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è, —â–æ–± —Ä–æ–∑–ø–æ—á–∞—Ç–∏!',
                pollsOptions: '–≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤',
                pollsVotes: '–≥–æ–ª–æ—Å—ñ–≤',
                pollStatusOpen: '–í–Ü–î–ö–†–ò–¢–ï',
                pollStatusClosed: '–ó–ê–ö–†–ò–¢–ï',
                
                // Create Poll / –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è
                createTitle: '–°—Ç–≤–æ—Ä–∏—Ç–∏ –ù–æ–≤–µ –û–ø–∏—Ç—É–≤–∞–Ω–Ω—è',
                createQuestionLabel: '–ü–∏—Ç–∞–Ω–Ω—è',
                createQuestionPlaceholder: '–í–≤–µ–¥—ñ—Ç—å –ø–∏—Ç–∞–Ω–Ω—è –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è',
                createOptionsLabel: '–í–∞—Ä—ñ–∞–Ω—Ç–∏',
                createOptionsMinimum: '(–º—ñ–Ω—ñ–º—É–º 2)',
                createOptionPlaceholder: '–í–∞—Ä—ñ–∞–Ω—Ç',
                createAddOption: '+ –î–æ–¥–∞—Ç–∏ –í–∞—Ä—ñ–∞–Ω—Ç',
                createSubmit: '–°—Ç–≤–æ—Ä–∏—Ç–∏ –û–ø–∏—Ç—É–≤–∞–Ω–Ω—è',
                createSuccess: '–û–ø–∏—Ç—É–≤–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ!',
                createErrorQuestion: '–ü–∏—Ç–∞–Ω–Ω—è –æ–±–æ–≤\'—è–∑–∫–æ–≤–µ',
                createErrorOptions: '–ë—É–¥—å –ª–∞—Å–∫–∞, –Ω–∞–¥–∞–π—Ç–µ —â–æ–Ω–∞–π–º–µ–Ω—à–µ 2 –≤–∞—Ä—ñ–∞–Ω—Ç–∏',
                
                // Poll Detail / –î–µ—Ç–∞–ª—ñ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è
                backToPolls: '‚Üê –ù–∞–∑–∞–¥ –¥–æ –û–ø–∏—Ç—É–≤–∞–Ω—å',
                pollClosed: '–¶–µ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è –∑–∞–∫—Ä–∏—Ç–µ',
                alreadyVoted: '–í–∏ –≤–∂–µ –ø—Ä–æ–≥–æ–ª–æ—Å—É–≤–∞–ª–∏ –≤ —Ü—å–æ–º—É –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—ñ',
                castVoteButton: '–ü—Ä–æ–≥–æ–ª–æ—Å—É–≤–∞—Ç–∏',
                totalVotes: '–í—Å—å–æ–≥–æ –ì–æ–ª–æ—Å—ñ–≤',
                
                // QR Code Section / –°–µ–∫—Ü—ñ—è QR-–∫–æ–¥—É
                shareTitle: '–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –û–ø–∏—Ç—É–≤–∞–Ω–Ω—è–º',
                shareDescription: '–°–∫–∞–Ω—É–π—Ç–µ QR-–∫–æ–¥, —â–æ–± –ø—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è',
                shareCopyLink: 'üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –ü–æ—Å–∏–ª–∞–Ω–Ω—è',
                shareDownloadQR: '‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ QR',
                shareLinkCopied: '–ü–æ—Å–∏–ª–∞–Ω–Ω—è –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É!',
                shareLinkFailed: '–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è. URL',
                
                // Scanner / –°–∫–∞–Ω–µ—Ä
                scanTitle: '–°–∫–∞–Ω—É–≤–∞—Ç–∏ QR-–∫–æ–¥',
                scanDescription: '–ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è',
                scanCancel: '–°–∫–∞—Å—É–≤–∞—Ç–∏',
                scanInvalid: '–ù–µ–¥—ñ–π—Å–Ω–∏–π QR-–∫–æ–¥. –ë—É–¥—å –ª–∞—Å–∫–∞, —Å–∫–∞–Ω—É–π—Ç–µ QR-–∫–æ–¥ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è.',
                scanErrorCamera: '–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø—É—Å–∫—É –∫–∞–º–µ—Ä–∏',
                scanErrorNoCameras: '–ö–∞–º–µ—Ä–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –ë—É–¥—å –ª–∞—Å–∫–∞, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–æ–∑–≤–æ–ª–∏.',
                
                // Poll Management / –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è–º
                closePollButton: '–ó–∞–∫—Ä–∏—Ç–∏ –û–ø–∏—Ç—É–≤–∞–Ω–Ω—è',
                deletePollButton: '–í–∏–¥–∞–ª–∏—Ç–∏ –û–ø–∏—Ç—É–≤–∞–Ω–Ω—è',
                closePollConfirm: '–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –∑–∞–∫—Ä–∏—Ç–∏ —Ü–µ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è? –ü—ñ—Å–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è –≥–æ–ª–æ—Å—É–≤–∞—Ç–∏ –±—ñ–ª—å—à–µ –Ω–µ –º–æ–∂–Ω–∞.',
                deletePollConfirm: '–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è? –¶—é –¥—ñ—é –Ω–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏.',
                
                // Poll Results / –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è
                votesCount: '–≥–æ–ª–æ—Å—ñ–≤',
                
                // Errors and Messages / –ü–æ–º–∏–ª–∫–∏ —Ç–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
                pollNotFound: '–û–ø–∏—Ç—É–≤–∞–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ',
                errorOccurred: '–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞',
                removeOption: '–í–∏–¥–∞–ª–∏—Ç–∏',
                
                // Empty state / –ü—É—Å—Ç–∏–π —Å—Ç–∞–Ω
                loading: '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...'
            }
        };
        
        // Current language
        let currentLanguage = 'en';
        
        // Translation function with fallback
        function t(key) {
            const translation = translations[currentLanguage]?.[key];
            if (translation !== undefined) {
                return translation;
            }
            // Fallback to English
            const fallback = translations.en[key];
            if (fallback !== undefined) {
                console.warn(`Missing translation for key "${key}" in language "${currentLanguage}"`);
                return fallback;
            }
            // Return key if not found
            console.error(`Translation key "${key}" not found`);
            return key;
        }
        
        // Initialize language from browser or localStorage
        function initializeLanguage() {
            // Check localStorage first
            const savedLang = localStorage.getItem('votingSystemLanguage');
            if (savedLang && translations[savedLang]) {
                currentLanguage = savedLang;
            } else {
                // Detect browser language
                const browserLang = navigator.language || navigator.userLanguage;
                if (browserLang.startsWith('uk')) {
                    currentLanguage = 'uk';
                } else {
                    currentLanguage = 'en';
                }
            }
            updatePageLanguage();
        }
        
        // Set language
        function setLanguage(lang) {
            if (translations[lang]) {
                currentLanguage = lang;
                localStorage.setItem('votingSystemLanguage', lang);
                updatePageLanguage();
            }
        }
        
        // Update all translatable elements on the page
        function updatePageLanguage() {
            // Update language switcher buttons
            document.querySelectorAll('.language-switcher button').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = document.getElementById(`lang-${currentLanguage}`);
            if (activeBtn) activeBtn.classList.add('active');
            
            // Update static elements
            const setText = (id, key) => {
                const el = document.getElementById(id);
                if (el) el.textContent = t(key);
            };
            
            setText('header-title', 'headerTitle');
            setText('user-id-label', 'userIdLabel');
            setText('nav-polls', 'navPolls');
            setText('nav-create', 'navCreate');
            setText('nav-scanner', 'navScanner');
            
            // Re-render current view if needed
            const activeView = document.querySelector('.view.active');
            if (activeView) {
                if (activeView.id === 'polls-view') {
                    renderPollsList();
                } else if (activeView.id === 'create-view') {
                    updateCreateFormLanguage();
                } else if (activeView.id === 'detail-view' && currentPollId) {
                    renderPollDetail(currentPollId);
                } else if (activeView.id === 'scanner-view') {
                    updateScannerLanguage();
                }
            }
        }
        
        // Update create form language
        function updateCreateFormLanguage() {
            const cardTitle = document.querySelector('#create-view h2');
            if (cardTitle) cardTitle.textContent = t('createTitle');
            
            const questionLabel = document.querySelector('#create-view label[for="poll-question"]');
            if (questionLabel) questionLabel.textContent = t('createQuestionLabel') + ' *';
            
            const questionInput = document.getElementById('poll-question');
            if (questionInput) questionInput.placeholder = t('createQuestionPlaceholder');
            
            const optionsLabel = document.querySelector('#create-view .form-group:nth-child(2) label');
            if (optionsLabel) optionsLabel.innerHTML = `${t('createOptionsLabel')} * ${t('createOptionsMinimum')}`;
            
            const addOptionBtn = document.querySelector('#create-view .btn-secondary');
            if (addOptionBtn) addOptionBtn.textContent = t('createAddOption');
            
            const submitBtn = document.querySelector('#create-view .btn-primary');
            if (submitBtn) submitBtn.textContent = t('createSubmit');
            
            // Update option placeholders
            updateOptionPlaceholders();
        }
        
        // Update scanner language
        function updateScannerLanguage() {
            const scannerTitle = document.querySelector('#scanner-view h2');
            if (scannerTitle) scannerTitle.textContent = t('scanTitle');
            
            const scannerDesc = document.querySelector('#scanner-view > .card > p');
            if (scannerDesc) scannerDesc.textContent = t('scanDescription');
            
            const cancelBtn = document.querySelector('#scanner-view .btn-secondary');
            if (cancelBtn) cancelBtn.textContent = t('scanCancel');
        }
        
        // Update option input placeholders
        function updateOptionPlaceholders() {
            const inputs = document.querySelectorAll('#options-container input');
            inputs.forEach((input, index) => {
                input.placeholder = `${t('createOptionPlaceholder')} ${index + 1}`;
            });
            
            const removeBtns = document.querySelectorAll('#options-container .btn-danger');
            removeBtns.forEach(btn => {
                btn.textContent = t('removeOption');
            });
        }
        
        // ==================== VOTING SYSTEM ====================
        
        // Voting System Implementation (Browser-compatible)
        class VotingSystem {
            constructor() {
                this.polls = new Map();
                this.votes = [];
                this.nextId = 1;
                this.listeners = [];
            }

            createPoll(question, options, creator) {
                if (!question || question.trim() === '') {
                    throw new Error('Question cannot be empty');
                }
                if (options.length < 2) {
                    throw new Error('Poll must have at least two options');
                }

                const id = `poll_${this.nextId++}`;
                const poll = {
                    id,
                    question: question.trim(),
                    options,
                    creator,
                    createdAt: new Date(),
                    closedAt: null,
                    status: 'open',
                };

                this.polls.set(id, poll);
                this.notifyListeners();
                return id;
            }

            castVote(pollId, userId, optionIndex) {
                const poll = this.polls.get(pollId);
                if (!poll) throw new Error('Poll not found');
                if (poll.status === 'closed') throw new Error('Cannot vote on a closed poll');
                if (optionIndex < 0 || optionIndex >= poll.options.length) throw new Error('Invalid option');

                const existingVote = this.votes.find(v => v.pollId === pollId && v.userId === userId);
                if (existingVote) throw new Error('User has already voted on this poll');

                this.votes.push({
                    pollId,
                    userId,
                    optionIndex,
                    timestamp: new Date(),
                });
                this.notifyListeners();
            }

            getResults(pollId) {
                const poll = this.polls.get(pollId);
                if (!poll) throw new Error('Poll not found');

                const voteCounts = new Array(poll.options.length).fill(0);
                const pollVotes = this.votes.filter(v => v.pollId === pollId);

                for (const vote of pollVotes) {
                    voteCounts[vote.optionIndex]++;
                }

                return {
                    pollId: poll.id,
                    question: poll.question,
                    options: poll.options,
                    voteCounts,
                    totalVotes: pollVotes.length,
                    status: poll.status,
                };
            }

            closePoll(pollId, userId) {
                const poll = this.polls.get(pollId);
                if (!poll) throw new Error('Poll not found');
                if (poll.creator !== userId) throw new Error('Only the poll creator can close this poll');

                poll.status = 'closed';
                poll.closedAt = new Date();
                this.notifyListeners();
            }

            deletePoll(pollId, userId) {
                const poll = this.polls.get(pollId);
                if (!poll) throw new Error('Poll not found');
                if (poll.creator !== userId) throw new Error('Only the poll creator can delete this poll');

                this.polls.delete(pollId);
                this.votes = this.votes.filter(v => v.pollId !== pollId);
                this.notifyListeners();
            }

            getPoll(pollId) {
                const poll = this.polls.get(pollId);
                if (!poll) throw new Error('Poll not found');
                return { ...poll };
            }

            getAllPolls() {
                return Array.from(this.polls.values());
            }

            hasUserVoted(pollId, userId) {
                return this.votes.some(v => v.pollId === pollId && v.userId === userId);
            }

            onChange(callback) {
                this.listeners.push(callback);
            }

            notifyListeners() {
                this.listeners.forEach(cb => cb());
            }
        }

        // Application State
        const votingSystem = new VotingSystem();
        let currentUserId = null;
        let currentPollId = null;

        // User Session Management
        function initializeUser() {
            let userId = localStorage.getItem('votingSystemUserId');
            if (!userId) {
                userId = `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                localStorage.setItem('votingSystemUserId', userId);
            }
            currentUserId = userId;
            document.getElementById('current-user-id').textContent = userId;
        }

        // View Management (will be replaced later with scanner support)
        let showView = function(viewName) {
            // Placeholder - replaced below with full implementation
        };

        // Create Poll Form
        function initializeCreateForm() {
            document.getElementById('create-poll-form').reset();
            document.getElementById('create-message').innerHTML = '';
            document.getElementById('question-error').textContent = '';
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            addOption();
            addOption();
        }

        function addOption() {
            const container = document.getElementById('options-container');
            const index = container.children.length;
            const div = document.createElement('div');
            div.className = 'option-input';
            div.innerHTML = `
                <input type="text" placeholder="${t('createOptionPlaceholder')} ${index + 1}" data-option-index="${index}">
                <button type="button" class="btn btn-danger btn-small" onclick="removeOption(this)" ${index < 2 ? 'disabled' : ''}>${t('removeOption')}</button>
            `;
            container.appendChild(div);
        }

        function removeOption(button) {
            const container = document.getElementById('options-container');
            if (container.children.length > 2) {
                button.parentElement.remove();
                updateOptionIndices();
            }
        }

        function updateOptionIndices() {
            const inputs = document.querySelectorAll('#options-container input');
            inputs.forEach((input, index) => {
                input.placeholder = `Option ${index + 1}`;
                input.dataset.optionIndex = index;
            });

            document.querySelectorAll('#options-container .option-input').forEach((div, index) => {
                const removeBtn = div.querySelector('button');
                removeBtn.disabled = index < 2;
            });
        }

        function handleCreatePoll(event) {
            event.preventDefault();
            
            // Clear previous errors
            document.getElementById('question-error').textContent = '';
            document.querySelectorAll('#options-container input').forEach(i => i.classList.remove('error'));

            const question = document.getElementById('poll-question').value.trim();
            const optionInputs = document.querySelectorAll('#options-container input');
            const options = Array.from(optionInputs)
                .map(input => input.value.trim())
                .filter(val => val !== '');

            let hasError = false;

            // Validate question
            if (!question) {
                document.getElementById('question-error').textContent = t('createErrorQuestion');
                document.getElementById('poll-question').classList.add('error');
                hasError = true;
            }

            // Validate options
            if (options.length < 2) {
                showMessage('create-message', t('createErrorOptions'), 'error');
                optionInputs.forEach(input => {
                    if (!input.value.trim()) input.classList.add('error');
                });
                hasError = true;
            }

            if (hasError) return;

            try {
                const pollId = votingSystem.createPoll(question, options, currentUserId);
                showMessage('create-message', t('createSuccess'), 'success');
                setTimeout(() => {
                    currentPollId = pollId;
                    showView('detail');
                }, 1000);
            } catch (error) {
                showMessage('create-message', error.message, 'error');
            }
        }

        // Polls List
        function renderPollsList() {
            const container = document.getElementById('polls-list');
            const polls = votingSystem.getAllPolls();

            if (polls.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        <h3>${t('noPollsTitle')}</h3>
                        <p>${t('noPollsText')}</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = polls.map(poll => {
                const results = votingSystem.getResults(poll.id);
                const statusText = poll.status === 'open' ? t('pollStatusOpen') : t('pollStatusClosed');
                return `
                    <div class="poll-card" onclick="viewPoll('${poll.id}')">
                        <h3>${poll.question}</h3>
                        <div class="poll-meta">
                            ${results.options.length} ${t('pollsOptions')} ‚Ä¢ ${results.totalVotes} ${t('pollsVotes')}
                            <span class="poll-status ${poll.status}">${statusText}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function viewPoll(pollId) {
            currentPollId = pollId;
            showView('detail');
        }

        // Poll Detail View
        function renderPollDetail(pollId) {
            const container = document.getElementById('poll-detail');
            try {
                const poll = votingSystem.getPoll(pollId);
                const results = votingSystem.getResults(pollId);
                const hasVoted = votingSystem.hasUserVoted(pollId, currentUserId);
                const isCreator = poll.creator === currentUserId;
                const isClosed = poll.status === 'closed';

                let content = `<h2>${poll.question}</h2>`;

                if (isClosed) {
                    content += `<div class="message info">${t('pollClosed')}</div>`;
                }

                if (hasVoted) {
                    content += `<div class="message info">${t('alreadyVoted')}</div>`;
                }

                // Show voting form or results
                if (!hasVoted && !isClosed) {
                    content += `
                        <form class="voting-form" onsubmit="handleVote(event, '${pollId}')">
                            <div class="radio-group">
                                ${poll.options.map((option, index) => `
                                    <label class="radio-option">
                                        <input type="radio" name="vote-option" value="${index}" required>
                                        <span>${option}</span>
                                    </label>
                                `).join('')}
                            </div>
                            <button type="submit" class="btn btn-primary">${t('castVoteButton')}</button>
                        </form>
                    `;
                } else {
                    content += renderResults(results);
                }

                // QR Code Section
                const pollUrl = window.location.origin + window.location.pathname + '#poll/' + pollId;
                content += `
                    <div class="qr-section">
                        <h3>${t('shareTitle')}</h3>
                        <p style="color: #666; margin-bottom: 10px;">${t('shareDescription')}</p>
                        <div class="qr-code-container">
                            <div id="qrcode-${pollId}"></div>
                        </div>
                        <div class="share-buttons">
                            <button class="btn btn-primary btn-small" onclick="copyPollLink('${pollUrl}')">${t('shareCopyLink')}</button>
                            <button class="btn btn-secondary btn-small" onclick="downloadQRCode('${pollId}')">${t('shareDownloadQR')}</button>
                        </div>
                    </div>
                `;

                // Management buttons for creator
                if (isCreator) {
                    content += `
                        <div class="action-buttons">
                            ${!isClosed ? `<button class="btn btn-secondary" onclick="handleClosePoll('${pollId}')">${t('closePollButton')}</button>` : ''}
                            <button class="btn btn-danger" onclick="handleDeletePoll('${pollId}')">${t('deletePollButton')}</button>
                        </div>
                    `;
                }

                container.innerHTML = content;

                // Generate QR Code
                setTimeout(() => {
                    const qrContainer = document.getElementById('qrcode-' + pollId);
                    if (qrContainer && !qrContainer.hasChildNodes()) {
                        new QRCode(qrContainer, {
                            text: pollUrl,
                            width: 200,
                            height: 200,
                            colorDark: '#667eea',
                            colorLight: '#ffffff',
                            correctLevel: QRCode.CorrectLevel.H
                        });
                    }
                }, 100);
            } catch (error) {
                container.innerHTML = `<div class="message error">${error.message}</div>`;
            }
        }

        function renderResults(results) {
            const maxVotes = Math.max(...results.voteCounts, 1);
            
            return `
                <div class="results">
                    ${results.options.map((option, index) => {
                        const votes = results.voteCounts[index];
                        const percentage = results.totalVotes > 0 ? (votes / results.totalVotes * 100).toFixed(1) : 0;
                        const widthPercentage = maxVotes > 0 ? (votes / maxVotes * 100) : 0;
                        
                        return `
                            <div class="result-bar">
                                <div class="result-label">
                                    <span>${option}</span>
                                    <span>${votes} ${t('votesCount')} (${percentage}%)</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${widthPercentage}%">
                                        ${votes > 0 ? votes : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                    <div class="total-votes">
                        ${t('totalVotes')}: ${results.totalVotes}
                    </div>
                </div>
            `;
        }

        function handleVote(event, pollId) {
            event.preventDefault();
            const selectedOption = document.querySelector('input[name="vote-option"]:checked').value;
            
            try {
                votingSystem.castVote(pollId, currentUserId, parseInt(selectedOption));
                renderPollDetail(pollId);
            } catch (error) {
                alert(error.message);
            }
        }

        function handleClosePoll(pollId) {
            if (confirm(t('closePollConfirm'))) {
                try {
                    votingSystem.closePoll(pollId, currentUserId);
                    renderPollDetail(pollId);
                } catch (error) {
                    alert(error.message);
                }
            }
        }

        function handleDeletePoll(pollId) {
            if (confirm(t('deletePollConfirm'))) {
                try {
                    votingSystem.deletePoll(pollId, currentUserId);
                    showView('polls');
                } catch (error) {
                    alert(error.message);
                }
            }
        }

        // Utility Functions
        function showMessage(containerId, message, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }

        // Real-time updates
        votingSystem.onChange(() => {
            const activeView = document.querySelector('.view.active');
            if (activeView.id === 'polls-view') {
                renderPollsList();
            } else if (activeView.id === 'detail-view' && currentPollId) {
                renderPollDetail(currentPollId);
            }
        });

        // QR Code Helper Functions
        function copyPollLink(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert(t('shareLinkCopied'));
            }).catch(() => {
                alert(t('shareLinkFailed') + ': ' + url);
            });
        }

        function downloadQRCode(pollId) {
            const qrCanvas = document.querySelector('#qrcode-' + pollId + ' canvas');
            if (qrCanvas) {
                const link = document.createElement('a');
                link.download = 'poll_' + pollId + '_qr.png';
                link.href = qrCanvas.toDataURL();
                link.click();
            }
        }

        // QR Scanner Functions
        let html5QrcodeScanner = null;

        function startScanner() {
            const qrReader = document.getElementById('qr-reader');
            if (!qrReader) return;

            if (html5QrcodeScanner) {
                html5QrcodeScanner.clear();
            }

            html5QrcodeScanner = new Html5Qrcode("qr-reader");
            
            Html5Qrcode.getCameras().then(cameras => {
                if (cameras && cameras.length) {
                    html5QrcodeScanner.start(
                        { facingMode: "environment" },
                        { fps: 10, qrbox: 250 },
                        (decodedText) => {
                            // Handle successful scan
                            if (decodedText.includes('#poll/')) {
                                const pollId = decodedText.split('#poll/')[1];
                                stopScanner();
                                currentPollId = pollId;
                                showView('detail');
                            } else {
                                document.getElementById('scan-result').innerHTML = 
                                    `<div class="message error">${t('scanInvalid')}</div>`;
                            }
                        },
                        (errorMessage) => {
                            // Scanning in progress, no action needed
                        }
                    ).catch(err => {
                        document.getElementById('scan-result').innerHTML = 
                            `<div class="message error">${t('scanErrorCamera')}: ${err}</div>`;
                    });
                }
            }).catch(err => {
                document.getElementById('scan-result').innerHTML = 
                    `<div class="message error">${t('scanErrorNoCameras')}</div>`;
            });
        }

        function stopScanner() {
            if (html5QrcodeScanner) {
                html5QrcodeScanner.stop().then(() => {
                    html5QrcodeScanner.clear();
                    html5QrcodeScanner = null;
                }).catch(() => {
                    // Already stopped
                });
            }
        }

        // URL Hash Handling for Deep Links
        function handleHashChange() {
            const hash = window.location.hash;
            if (hash.startsWith('#poll/')) {
                const pollId = hash.substring(6);
                try {
                    votingSystem.getPoll(pollId);
                    currentPollId = pollId;
                    showView('detail');
                } catch (error) {
                    alert(t('pollNotFound') + ': ' + pollId);
                    window.location.hash = '';
                    showView('polls');
                }
            }
        }

        // Update showView to handle scanner
        showView = function(viewName) {
            // Stop scanner when leaving scanner view
            if (viewName !== 'scanner') {
                stopScanner();
            }

            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));

            if (viewName === 'polls') {
                document.getElementById('polls-view').classList.add('active');
                document.querySelector('.nav button:nth-child(1)').classList.add('active');
                renderPollsList();
            } else if (viewName === 'create') {
                document.getElementById('create-view').classList.add('active');
                document.querySelector('.nav button:nth-child(2)').classList.add('active');
                initializeCreateForm();
            } else if (viewName === 'scanner') {
                document.getElementById('scanner-view').classList.add('active');
                document.querySelector('.nav button:nth-child(3)').classList.add('active');
                document.getElementById('scan-result').innerHTML = '';
                startScanner();
            } else if (viewName === 'detail') {
                document.getElementById('detail-view').classList.add('active');
                renderPollDetail(currentPollId);
                // Update URL hash
                window.location.hash = '#poll/' + currentPollId;
            }
        };

        // Initialize
        initializeLanguage();  // Initialize language first
        initializeUser();
        
        // Handle URL hash on load
        window.addEventListener('hashchange', handleHashChange);
        handleHashChange();
        
        // If no hash, show polls list
        if (!window.location.hash) {
            renderPollsList();
        }
    </script>
</body>
</html>

